<div class="dashboard-container">
  <app-header
    title="Dashboard"
    [logoWithTagline]="false"
    [navLinks]="navLinks"
    [showLogoLink]="true" />

  <main class="dashboard-content">
    @if (loading()) {
      <div class="loading-container">
        <p>Loading teams...</p>
      </div>
    } @else if (error()) {
      <div class="error-container">
        <p>{{ error() }}</p>
        <button (click)="loadTeams()">Retry</button>
      </div>
    } @else if (teams().length === 0) {
      <div class="empty-container">
        <p>No teams available.</p>
      </div>
    } @else {
      <div class="selectors-container">
        <div class="team-selector-container">
          <label for="team-select" class="selector-label">Select Team</label>
          <select
            id="team-select"
            class="selector"
            [value]="selectedTeamId()"
            (change)="onTeamChange($event)">
            @for (team of teams(); track team.id) {
              <option [value]="team.id">{{ team.name }}</option>
            }
          </select>
        </div>

        @if (availableProjects().length > 0) {
          <div class="project-selector-container">
            <label for="project-select" class="selector-label">Select Project</label>
            <select
              id="project-select"
              class="selector"
              [value]="selectedProjectId()"
              (change)="onProjectChange($event)">
              @for (project of availableProjects(); track project.uuid) {
                <option [value]="project.uuid">{{ project.name || 'Unnamed Project' }}</option>
              }
            </select>
          </div>
        } @else {
          <div class="project-selector-container">
            <label for="project-select" class="selector-label">Select Project</label>
            <select
              id="project-select"
              class="selector"
              disabled>
              <option>No projects available</option>
            </select>
          </div>
        }

        <a routerLink="/teams" class="manage-link">Something Missing? Manage Teams & Projects</a>
      </div>

      <div class="metrics-container">
      <!-- Capacity Metric Card -->
      <div class="metric-card">
        <div class="metric-header">
          <h2 class="metric-title">Capacity (Man-Days)</h2>
          <div class="metric-icon">ðŸ‘¥</div>
        </div>
        <div class="metric-body">
          <div class="metric-comparison">
            <div class="metric-item">
              <span class="metric-label">Projected</span>
              <span class="metric-value projected">{{ capacityProjected() }}</span>
            </div>
            <div class="metric-item">
              <span class="metric-label">Performed</span>
              <span class="metric-value performed">{{ capacityPerformed() }}</span>
            </div>
          </div>
          <div class="metric-progress">
            <div class="progress-bar">
              <div
                class="progress-fill"
                [style.width.%]="capacityPercentage()"
                [class.over]="capacityPercentage() > 100"
                [class.under]="capacityPercentage() < 100"
              ></div>
            </div>
            <div class="progress-info">
              <span class="progress-percentage">{{ capacityPercentage() | number:'1.1-1' }}%</span>
              <span class="progress-difference" [class.positive]="capacityDifference() > 0" [class.negative]="capacityDifference() < 0">
                {{ capacityDifference() > 0 ? '+' : '' }}{{ capacityDifference() }} days
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Story Points Metric Card -->
      <div class="metric-card">
        <div class="metric-header">
          <h2 class="metric-title">Story Points</h2>
          <div class="metric-icon">ðŸ“Š</div>
        </div>
        <div class="metric-body">
          <div class="metric-comparison">
            <div class="metric-item">
              <span class="metric-label">Projected</span>
              <span class="metric-value projected">{{ storyPointsProjected() }}</span>
            </div>
            <div class="metric-item">
              <span class="metric-label">Delivered</span>
              <span class="metric-value performed">{{ storyPointsDelivered() }}</span>
            </div>
          </div>
          <div class="metric-progress">
            <div class="progress-bar">
              <div
                class="progress-fill"
                [style.width.%]="storyPointsPercentage()"
                [class.over]="storyPointsPercentage() > 100"
                [class.under]="storyPointsPercentage() < 100"
              ></div>
            </div>
            <div class="progress-info">
              <span class="progress-percentage">{{ storyPointsPercentage() | number:'1.1-1' }}%</span>
              <span class="progress-difference" [class.positive]="storyPointsDifference() > 0" [class.negative]="storyPointsDifference() < 0">
                {{ storyPointsDifference() > 0 ? '+' : '' }}{{ storyPointsDifference() }} points
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
    }
  </main>
</div>

